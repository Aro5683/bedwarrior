<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Create Master BEDX</title>
</head>
<body>

<h2>Admin - Create Master BEDX</h2>

<input type="file" id="pdfFile" accept="application/pdf"><br><br>
<input type="text" id="masterKey" placeholder="Enter Master Secret Key"><br><br>
<button onclick="createBedx()">Create BEDX</button>

<script>
async function createBedx(){

  const file = document.getElementById("pdfFile").files[0];
  const secret = document.getElementById("masterKey").value;

  if(!file || !secret){
    alert("Upload PDF and enter master key");
    return;
  }

  const arrayBuffer = await file.arrayBuffer();

  const encoder = new TextEncoder();
  const keyMaterial = await crypto.subtle.digest(
    "SHA-256",
    encoder.encode(secret)
  );

  const key = await crypto.subtle.importKey(
    "raw",
    keyMaterial,
    { name: "AES-GCM" },
    false,
    ["encrypt"]
  );

  const iv = crypto.getRandomValues(new Uint8Array(12));

  const encrypted = await crypto.subtle.encrypt(
    { name: "AES-GCM", iv },
    key,
    arrayBuffer
  );

  const bedx = {
    iv: Array.from(iv),
    data: Array.from(new Uint8Array(encrypted))
  };

  const blob = new Blob(
    [JSON.stringify(bedx)],
    {type:"application/octet-stream"}
  );

  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "master.bedx";
  a.click();

  alert("master.bedx created.");
}
</script>

</body>
</html>
