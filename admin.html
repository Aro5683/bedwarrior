<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Admin - Create Master BEDX</title>
</head>
<body>

<h2>Admin - Upload PDF</h2>
<input type="file" id="pdfFile" accept="application/pdf">
<button onclick="createMaster()">Create master.bedx</button>

<script>
const MASTER_SECRET = "BED_SECRET_2025_PRIVATE";

async function createMaster(){

  const file = document.getElementById("pdfFile").files[0];
  if(!file){ alert("Upload PDF"); return; }

  const pdfBuffer = await file.arrayBuffer();

  const keyMaterial = await crypto.subtle.digest(
    "SHA-256",
    new TextEncoder().encode(MASTER_SECRET)
  );

  const key = await crypto.subtle.importKey(
    "raw",
    keyMaterial,
    { name: "AES-GCM" },
    false,
    ["encrypt"]
  );

  const iv = crypto.getRandomValues(new Uint8Array(12));

  const encrypted = await crypto.subtle.encrypt(
    { name: "AES-GCM", iv },
    key,
    pdfBuffer
  );

  const bedx = {
    iv: Array.from(iv),
    data: Array.from(new Uint8Array(encrypted))
  };

  const blob = new Blob(
    [JSON.stringify(bedx)],
    {type:"application/octet-stream"}
  );

  const a = document.createElement("a");
  a.href = URL.createObjectURL(blob);
  a.download = "master.bedx";
  a.click();

  alert("Upload master.bedx to GitHub");
}
</script>

</body>
</html>
